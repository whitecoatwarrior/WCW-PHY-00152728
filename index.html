<meta name='viewport' content='width=device-width, initial-scale=1'/><meta name='viewport' content='width=device-width, initial-scale=1'/><meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WHITE COAT WARRIORS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* All CSS styles remain the same as in the original file */
        :root {
            --primary-blue: #1a56db;
            --secondary-blue: #0ea5e9;
            --dark-blue: #1e3a8a;
            --light-blue: #dbeafe;
            --accent-green: #10b981;
            --accent-orange: #f59e0b;
            --accent-red: #ef4444;
            --accent-purple: #8b5cf6;
            --accent-pink: #ec4899;
            --accent-teal: #14b8a6;
            --accent-yellow: #fbbf24;
            --accent-amber: #f59e0b;
            --vibrant-blue: #3b82f6;
            --vibrant-green: #22c55e;
            --vibrant-purple: #a855f7;
            --vibrant-pink: #e879f9;
            --gradient-blue: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            --gradient-green: linear-gradient(135deg, var(--accent-green), #34d399);
            --gradient-orange: linear-gradient(135deg, var(--accent-orange), #f97316);
            --gradient-red: linear-gradient(135deg, var(--accent-red), #f87171);
            --gradient-purple: linear-gradient(135deg, var(--accent-purple), #a78bfa);
            --gradient-pink: linear-gradient(135deg, var(--accent-pink), #f472b6);
            --gradient-teal: linear-gradient(135deg, var(--accent-teal), #2dd4bf);
            --gradient-yellow: linear-gradient(135deg, var(--accent-yellow), #f59e0b);
            --gradient-vibrant: linear-gradient(135deg, #4f46e5, #7c3aed, #ec4899);
            --shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 2px 5px rgba(0, 0, 0, 0.08);
            --shadow-xl: 0 5px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px;
            color: #1e3a8a;
            font-size: 8.25px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }

        .logo {
            text-align: center;
            margin-bottom: 9px;
        }

        .logo h1 {
            font-size: 1.05rem;
            font-weight: 800;
            color: var(--dark-blue);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5px;
            background: var(--gradient-vibrant);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo p {
            color: var(--primary-blue);
            font-weight: 600;
            font-size: 0.525rem;
        }

        .page {
            background: white;
            border-radius: 9px;
            padding: 9px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            display: none;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: linear-gradient(to bottom right, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            backdrop-filter: blur(10px);
        }

        .active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(6px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .promo-banner {
            background: var(--gradient-vibrant);
            color: white;
            padding: 11.25px;
            border-radius: 7.5px;
            margin-bottom: 11.25px;
            text-align: center;
            font-size: 0.45rem;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .promo-banner::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
            z-index: 1;
        }

        .promo-banner h2 {
            font-size: 0.675rem;
            margin-bottom: 6px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 2;
        }

        .promo-banner p {
            line-height: 1.4;
            text-align: justify;
            position: relative;
            z-index: 2;
        }

        .form-group {
            margin-bottom: 6px;
        }

        .form-label {
            display: block;
            margin-bottom: 1.5px;
            font-weight: 600;
            color: var(--dark-blue);
            font-size: 0.525rem;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 4.5px 6.75px;
            border: 1.5px solid var(--light-blue);
            border-radius: 3.75px;
            font-size: 0.525rem;
            background: #f8fafc;
            transition: all 0.2s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 2px rgba(26, 86, 219, 0.15);
        }

        .input-container {
            position: relative;
        }

        .password-container .form-input {
            padding-right: 22.5px;
        }

        .input-icon {
            position: absolute;
            right: 7.5px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-blue);
            font-size: 0.525rem;
            cursor: pointer;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 4.5px 7.5px;
            border: none;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.525rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            gap: 3px;
            width: 100%;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-blue);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(26, 86, 219, 0.2);
        }

        .btn-contact {
            background: var(--gradient-green);
            color: white;
        }

        .btn-contact:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25d366, #128c7e);
            color: white;
        }

        .btn-whatsapp:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(37, 211, 102, 0.2);
        }

        .btn-purple {
            background: var(--gradient-purple);
            color: white;
        }

        .btn-purple:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(139, 92, 246, 0.2);
        }

        .btn-red {
            background: var(--gradient-red);
            color: white;
        }

        .btn-red:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);
        }

        .btn-orange {
            background: var(--gradient-orange);
            color: white;
        }

        .btn-orange:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(245, 158, 11, 0.2);
        }

        .error-box {
            background: #fee2e2;
            color: var(--accent-red);
            padding: 3.75px 5.25px;
            border-radius: 2.25px;
            margin-top: 4.5px;
            display: none;
            font-weight: 600;
            font-size: 0.525rem;
            border-left: 2.25px solid var(--accent-red);
        }

        .success-box {
            background: #d1fae5;
            color: var(--accent-green);
            padding: 3.75px 5.25px;
            border-radius: 2.25px;
            margin-top: 4.5px;
            display: none;
            font-weight: 600;
            font-size: 0.525rem;
            border-left: 2.25px solid var(--accent-green);
        }

        .notification-box {
            background: #fef3c7;
            color: #d97706;
            padding: 7.5px;
            border-radius: 4.5px;
            margin-top: 7.5px;
            font-weight: 600;
            font-size: 0.525rem;
            text-align: center;
            border-left: 3px solid #f59e0b;
        }

        .quiz-notification {
            position: fixed;
            top: 15px;
            right: 15px;
            background: white;
            padding: 11.25px;
            border-radius: 7.5px;
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            display: none;
            max-width: 225px;
            border-left: 3.75px solid var(--accent-green);
            animation: slideInRight 0.3s ease;
            transform: translateX(100%);
        }

        .quiz-notification.show {
            display: block;
            transform: translateX(0);
        }

        .quiz-notification.warning {
            border-left-color: var(--accent-orange);
        }

        .quiz-notification.error {
            border-left-color: var(--accent-red);
        }

        .quiz-notification-content {
            display: flex;
            flex-direction: column;
            gap: 7.5px;
        }

        .quiz-notification-title {
            font-weight: 700;
            font-size: 0.6rem;
            color: var(--dark-blue);
        }

        .quiz-notification-message {
            font-size: 0.525rem;
            color: #4b5563;
        }

        .quiz-notification-actions {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
        }

        .quiz-notification-btn {
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 0.4875rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .quiz-notification-btn.primary {
            background: var(--gradient-blue);
            color: white;
        }

        .quiz-notification-btn.secondary {
            background: #f3f4f6;
            color: #4b5563;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .main-page-buttons {
            display: grid;
            gap: 6px;
            margin-top: 9px;
        }

        .quiz-access-section {
            display: none;
            flex-direction: column;
            gap: 6px;
            margin-top: 9px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
            padding-bottom: 4.5px;
            border-bottom: 1.5px solid var(--light-blue);
        }

        .quiz-title-container {
            display: flex;
            flex-direction: column;
            gap: 2.25px;
            width: 80%;
        }

        .quiz-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.525rem;
            color: var(--dark-blue);
            font-weight: 600;
        }

        .timer-container {
            display: flex;
            gap: 4.5px;
            justify-content: flex-end;
            width: 100%;
        }

        .timer, .question-timer {
            background: var(--gradient-blue);
            color: white;
            padding: 2.25px 4.5px;
            border-radius: 7.5px;
            font-weight: 700;
            font-size: 0.525rem;
            box-shadow: var(--shadow);
            white-space: nowrap;
        }

        .timer.total-timer {
            background: var(--gradient-orange);
        }

        .progress-container {
            width: 100%;
            height: 4.5px;
            background: #e5e7eb;
            border-radius: 2.25px;
            overflow: hidden;
            margin-bottom: 6px;
            box-shadow: var(--shadow);
        }

        .progress-bar {
            height: 100%;
            border-radius: 2.25px;
            transition: width 0.4s ease;
            background: var(--gradient-vibrant);
        }

        .question-nav {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(10.5px, 1fr));
            gap: 2.25px;
            margin-bottom: 6px;
        }

        .question-nav-item {
            width: 10.5px;
            height: 10.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2.25px;
            font-weight: 700;
            font-size: 0.375rem;
            cursor: pointer;
            background: white;
            border: 1.5px solid var(--light-blue);
            transition: all 0.2s;
        }

        .question-nav-item.current {
            background: var(--gradient-vibrant);
            color: white;
            border-color: var(--primary-blue);
            transform: scale(1.1);
        }

        .question-nav-item.solved {
            background: var(--gradient-green);
            color: white;
            border-color: var(--accent-green);
        }

        .question-nav-item.visited {
            background: var(--gradient-orange);
            color: white;
            border-color: var(--accent-orange);
        }

        .question-container {
            margin-bottom: 6px;
        }

        .question-text {
            font-size: 0.5625rem;
            font-weight: 700;
            margin-bottom: 4.5px;
            color: var(--dark-blue);
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 3px;
            margin-bottom: 6px;
        }

        .option {
            padding: 3.75px 6px;
            border: 1.5px solid var(--light-blue);
            border-radius: 3.75px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            background: #f8fafc;
            font-size: 0.525rem;
            position: relative;
        }

        .option:hover {
            border-color: var(--primary-blue);
            background: #e0f2fe;
            transform: translateY(-1px);
        }

        .option.selected {
            border-color: var(--primary-blue);
            background: #dbeafe;
        }

        .option.correct {
            border-color: var(--accent-green);
            background: #d1fae5;
        }

        .option.incorrect {
            border-color: var(--accent-red);
            background: #fee2e2;
        }

        .option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .reasoning {
            background: #f8fafc;
            border-radius: 3.75px;
            padding: 6px;
            margin-top: 6px;
            display: none;
            border-left: 2.25px solid var(--primary-blue);
            font-size: 0.525rem;
        }

        .reasoning-title {
            font-weight: 700;
            margin-bottom: 3px;
            color: var(--dark-blue);
            font-size: 0.5625rem;
        }

        .navigation-buttons {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-top: 9px;
        }

        .nav-btn {
            padding: 3.75px 5.25px;
            border-radius: 3.75px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            font-size: 0.525rem;
            display: flex;
            align-items: center;
            gap: 2.25px;
            justify-content: center;
            width: 100%;
        }

        .btn-back {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            color: white;
        }

        .btn-next {
            background: linear-gradient(135deg, #1d4ed8, #3b82f6);
            color: white;
        }

        .btn-reasoning {
            background: var(--gradient-purple);
            color: white;
        }

        .btn-reasoning.disabled {
            background: #dc3545;
            color: white;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-reasoning.disabled:hover {
            background: #dc3545;
            transform: none;
            box-shadow: none;
        }

        .btn-submit {
            background: var(--gradient-green);
            color: white;
        }

        .results-header-buttons {
            display: flex;
            flex-direction: column;
            gap: 3.75px;
            margin-bottom: 9px;
        }

        .results-header-buttons .btn {
            padding: 3px 4.5px;
            font-size: 0.4875rem;
            width: 100%;
        }

        .result-card {
            background: linear-gradient(135deg, #f8fafc, #e0f2fe);
            border-radius: 6px;
            padding: 9px;
            text-align: center;
            margin-bottom: 9px;
            box-shadow: var(--shadow);
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .result-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-vibrant);
        }

        .result-card h2 {
            font-size: 0.675rem;
            margin-bottom: 6px;
            color: var(--dark-blue);
        }

        .result-card table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.525rem;
            margin-top: 6px;
            box-shadow: var(--shadow);
        }

        .result-card th, .result-card td {
            padding: 3.75px;
            border: 1px solid #dbeafe;
            text-align: left;
        }

        .result-card th {
            background-color: var(--light-blue);
            font-weight: 600;
        }

        .result-card td {
            background-color: #f8fafc;
        }

        .result-actions {
            display: flex;
            flex-direction: column;
            gap: 4.5px;
            margin-top: 9px;
        }

        .all-mcqs-list {
            display: flex;
            flex-direction: column;
            gap: 11.25px;
        }

        .all-mcq-item {
            padding: 7.5px;
            border: 1px solid var(--light-blue);
            border-radius: 6px;
            background: #f8fafc;
            position: relative;
        }

        .all-mcq-item .question-text {
            color: var(--dark-blue);
            font-size: 0.6rem;
            font-weight: 700;
        }

        .all-mcq-options {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-top: 4.5px;
        }

        .all-mcq-option {
            font-size: 0.525rem;
            padding: 3px 4.5px;
            border-radius: 3px;
            border: 1px solid #e5e7eb;
        }

        .all-mcq-option.correct {
            background: #d1fae5;
            color: var(--accent-green);
            font-weight: 600;
            border-color: #a7f3d0;
        }

        .all-mcq-reasoning {
            margin-top: 6px;
            font-size: 0.525rem;
            color: #4b5563;
            padding: 6px;
            background: #f8fafc;
            border-radius: 3px;
            border-left: 2.25px solid var(--primary-blue);
        }

        .all-mcq-reasoning strong {
            color: var(--dark-blue);
        }

        .quick-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 9px;
            gap: 6px;
        }

        .stat-card {
            flex: 1;
            background: white;
            border-radius: 4.5px;
            padding: 6px;
            text-align: center;
            box-shadow: var(--shadow);
            border-top: 2px solid var(--primary-blue);
        }

        .stat-card.correct {
            border-top-color: var(--accent-green);
        }

        .stat-card.incorrect {
            border-top-color: var(--accent-red);
        }

        .stat-card.unanswered {
            border-top-color: var(--accent-orange);
        }

        .stat-value {
            font-size: 0.9rem;
            font-weight: 800;
            margin-bottom: 1.5px;
        }

        .stat-label {
            font-size: 0.4875rem;
            font-weight: 600;
            color: #6b7280;
        }

        .performance-meter {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin: 6px 0;
        }

        .performance-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.4s ease;
            background: var(--gradient-vibrant);
        }

        @media (max-width: 768px) {
            .quiz-header {
                flex-direction: column;
                gap: 4.5px;
                align-items: flex-start;
            }
            
            .navigation-buttons {
                grid-template-columns: 1fr;
            }
            
            .timer-container {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 3.75px;
                justify-content: flex-end;
                width: 100%;
            }
            
            .quiz-title-container {
                width: 100%;
            }
            
            .result-actions {
                flex-direction: column;
            }
            
            .promo-banner {
                padding: 9px;
            }
            
            .promo-banner h2 {
                font-size: 0.6rem;
            }
            
            .promo-banner p {
                font-size: 0.4125rem;
            }
        }
    </style>
</head>
<body>
    <div class="quiz-notification" id="quiz-notification">
        <div class="quiz-notification-content">
            <div class="quiz-notification-title" id="notification-title">Quiz Progress Found</div>
            <div class="quiz-notification-message" id="notification-message">You have an unfinished quiz. Do you want to continue where you left off?</div>
            <div class="quiz-notification-actions">
                <button class="quiz-notification-btn secondary" id="notification-no">Start Fresh</button>
                <button class="quiz-notification-btn primary" id="notification-yes">Continue</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="logo">
            <h1>WHITE COAT WARRIORS</h1>
            <p>Excellence in Educational Assessment</p>
        </div>

        <div id="signin-page" class="page active">
            <div class="promo-banner">
                <h2><i class="fas fa-graduation-cap"></i> Unlock Your Potential with WHITE COAT WARRIORS</h2>
                <p>Boost your preparation with WHITE COAT WARRIORS's realistic online tests, crafted by experts to mirror the actual exam's pattern and challenge. Experience instant feedback, detailed analysis, and flexible online access – your pathway to confidence and success!</p>
            </div>
            
            <h2><i class="fas fa-lock"></i> Access Test</h2>
            <p>Sign in or use your access code</p>
            
            <div class="main-page-buttons">
                <button class="btn btn-primary" onclick="showQuizAccessForm()">
                    <i class="fas fa-key"></i>
                    <span>Sign In with Quiz Access Code</span>
                </button>
                <button class="btn btn-primary" onclick="showRegistrationPage()">
                    <i class="fas fa-user-plus"></i>
                    <span>Sign Up to Get Quiz Access</span>
                </button>
                <button class="btn btn-purple" onclick="showDeveloperAccessForm()">
                    <i class="fas fa-code"></i>
                    <span>Developer Access</span>
                </button>
            </div>
            
            <div id="developer-access-form" class="quiz-access-section">
                <h3><i class="fas fa-user-secret"></i> Developer Login</h3>
                <div class="password-container input-container">
                    <input type="password" id="developerPassword" class="form-input" placeholder="Enter the Developer Password">
                    <i class="fas fa-eye-slash input-icon" id="toggleDeveloperPassword"></i>
                </div>
                <button class="btn btn-purple" onclick="checkDeveloperPassword()">
                    <span>Log In</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
                <div id="dev-error-box" class="error-box">
                    <i class="fas fa-exclamation-circle"></i> Invalid developer password.
                </div>
            </div>
            
            <div id="quiz-access-form" class="quiz-access-section">
                <h3><i class="fas fa-key"></i> Enter Quiz Access Code</h3>
                <div class="password-container input-container">
                    <input type="password" id="quizAccessCode" class="form-input" placeholder="Enter your 12-Digit Quiz Access Code here">
                    <i class="fas fa-eye-slash input-icon" id="toggleQuizAccessCode"></i>
                </div>
                <button class="btn btn-primary" onclick="accessQuiz(document.getElementById('quizAccessCode').value)">
                    <span>Access Quiz</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
                <div id="quiz-error-box" class="error-box">
                    <i class="fas fa-exclamation-circle"></i> Invalid quiz access code.
                </div>
            </div>
            
        </div>

        <div id="registration-page" class="page">
            <div class="promo-banner">
                <h2><i class="fas fa-graduation-cap"></i> Unlock Your Potential with WHITE COAT WARRIORS</h2>
                <p>Boost your preparation with WHITE COAT WARRIORS's realistic online tests, crafted by experts to mirror the actual exam's pattern and challenge. Experience instant feedback, detailed analysis, and flexible online access – your pathway to confidence and success!</p>
            </div>
            
            <h2><i class="fas fa-user-edit"></i> Student Registration</h2>
            <p>Please provide your details to register</p>
            
            <div class="form-group">
                <label class="form-label"><i class="fas fa-user"></i> Student Name</label>
                <input type="text" id="studentName" class="form-input" placeholder="Enter your full name">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-user-friends"></i> Father Name</label>
                <input type="text" id="fatherName" class="form-input" placeholder="Enter your father's name">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-envelope"></i> Email Address</label>
                <input type="email" id="email" class="form-input" placeholder="Enter your email address">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-phone"></i> Mobile Number (WhatsApp)</label>
                <input type="tel" id="mobile" class="form-input" placeholder="+92XXXXXXXXXX">
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-city"></i> City / District</label>
                <input type="text" id="city" class="form-input" placeholder="Enter your city/district">
            </div>
            <button class="btn btn-primary" onclick="handleRegistration()">
                <span>Submit to Get Access to Quiz</span>
                <i class="fas fa-arrow-right"></i>
            </button>
            <button class="btn btn-red" style="margin-top: 3.75px;" onclick="showPage('signin-page')">
                <i class="fas fa-chevron-left"></i> Back to Home
            </button>
        </div>

        <div id="quiz-page" class="page">
            <div class="promo-banner">
                <h2><i class="fas fa-graduation-cap"></i> Unlock Your Potential with WHITE COAT WARRIORS</h2>
                <p>Boost your preparation with WHITE COAT WARRIORS's realistic online tests, crafted by experts to mirror the actual exam's pattern and challenge. Experience instant feedback, detailed analysis, and flexible online access – your pathway to confidence and success!</p>
            </div>

            <div class="quiz-header">
                <div class="quiz-title-container">
                    <h2 id="quiz-title"></h2>
                    <div class="quiz-info">
                        <span><i class="fas fa-book"></i> Subject: <span id="quiz-subject">English Grammar</span></span>
                        <span><i class="fas fa-clock"></i> Per MCQ: <span id="per-mcq-time">1</span> Minute</span>
                    </div>
                </div>
            </div>
            <div class="timer-container">
                <div class="timer" id="question-timer">60</div>
                <div class="timer total-timer" id="timer">40:00</div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="quiz-progress"></div>
            </div>

            <div class="question-nav" id="question-nav"></div>
            
            <div class="question-container">
                <div class="question-text" id="question-text"></div>
                <div class="options-container" id="options-container"></div>
                <div class="reasoning" id="reasoning">
                    <div class="reasoning-title"><i class="fas fa-lightbulb"></i> Explanation:</div>
                    <div id="reasoning-text"></div>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn btn-back" onclick="navigateQuestion('prev')">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="nav-btn btn-next" onclick="navigateQuestion('next')">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
                <button class="nav-btn btn-reasoning disabled" id="reasoning-btn" onclick="toggleReasoning()">
                    <i class="fas fa-lightbulb"></i> Reasoning
                </button>
                <button class="nav-btn btn-submit" onclick="submitTest()">
                    Submit <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <div id="results-page" class="page">
            <div class="results-header-buttons">
                <a id="website-link" href="#" target="_blank" class="btn btn-primary"><i class="fas fa-globe"></i> Website</a>
                <a id="whatsapp-contact-link" href="#" target="_blank" class="btn btn-whatsapp"><i class="fab fa-whatsapp"></i> Whatsapp Contact</a>
                <a id="whatsapp-community-link" href="#" target="_blank" class="btn btn-whatsapp"><i class="fas fa-users"></i> Whatsapp Community</a>
            </div>
            
            <div class="quick-stats">
                <div class="stat-card correct">
                    <div class="stat-value" id="correct-count">0</div>
                    <div class="stat-label">Correct</div>
                </div>
                <div class="stat-card incorrect">
                    <div class="stat-value" id="incorrect-count">0</div>
                    <div class="stat-label">Incorrect</div>
                </div>
                <div class="stat-card unanswered">
                    <div class="stat-value" id="unanswered-count">0</div>
                    <div class="stat-label">Unanswered</div>
                </div>
            </div>
            
            <div class="performance-meter">
                <div class="performance-fill" id="performance-fill"></div>
            </div>
            
            <div class="result-card">
                <h2><i class="fas fa-user-graduate"></i> Student Information</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Detail</th>
                        </tr>
                    </thead>
                    <tbody id="student-info-table"></tbody>
                </table>
            </div>

            <div class="result-card">
                <h2><i class="fas fa-chart-bar"></i> Test Results</h2>
                <table>
                    <tbody id="quiz-results-table"></tbody>
                </table>
            </div>
            
            <div class="result-actions">
                <button class="btn btn-primary" onclick="restartTest()">
                    <i class="fas fa-redo"></i> Retake Full Test
                </button>
                <button class="btn btn-primary" onclick="retakeIncorrect()">
                    <i class="fas fa-bolt"></i> Retake Incorrect Questions
                </button>
                <button class="btn btn-primary" onclick="viewAllMcqs()">
                    <i class="fas fa-clipboard-list"></i> View All MCQs
                </button>
            </div>
        </div>

        <div id="all-mcqs-page" class="page">
            <h2><i class="fas fa-list-alt"></i> All MCQs and Solutions</h2>
            <div class="all-mcqs-list" id="all-mcqs-list"></div>
            <button class="btn btn-primary" onclick="showPage('results-page')">
                <i class="fas fa-arrow-left"></i> Back to Results
            </button>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html><script>// ***************************************************************
// !! IMPORTANT: GOOGLE APPS SCRIPT URL FOR DATA LOGGING !!
const SHEET_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwuJD-NddcLbcaap_utAGs0yXcuVjaDFOUZn9SC1Cjs9h9jLrtGAiaiHDPq7e7H3tkZOg/exec';
// ***************************************************************

// Quiz Data
const quizData_WCW_CHE_005 = [
    {
        question: "Consider a hypothetical scenario where the Earth's atmosphere suddenly experiences an extreme increase in intermolecular attractive forces, while all other conditions remain constant. What profound change would this primarily imply about the atmosphere's fundamental nature?",
        options: [
            "It would expand significantly due to increased energy.",
            "Its particles would exhibit only translational motion.",
            "It would become more resistant to compression.",
            "It would tend towards a more condensed, less gaseous state."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. Gases are characterized by weak intermolecular forces. An extreme increase in these forces would diminish the 'high energy' characteristic of gases and cause them to behave less like a gas, leading towards liquefaction or solidification, which are more condensed states."
    },
    {
        question: "A sealed container is introduced with two distinct gaseous substances. Over an extended period, the molecules of both gases are found to be uniformly distributed throughout the container. This observation is a direct consequence of which inherent characteristic of gases?",
        options: [
            "Their negligible volume compared to the container.",
            "Their random, undirected molecular movement.",
            "Their perfectly elastic collisions.",
            "Their identical mass and size for different gases."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. Gases diffuse to fill available space because their molecules move randomly in all directions. Uniform distribution implies this pervasive random motion and diffusion."
    },
    {
        question: "What characteristic of gas particles most directly facilitates the phenomenon of 'intimate mixing' when a liquid and a gas interact?",
        options: [
            "Their constant motion in straight lines.",
            "Their inherent ability to form chemical bonds.",
            "Their negligible attractive forces.",
            "Their capacity to change phase readily."
        ],
        correctAnswer: 1,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. 'Intimate mixing' is defined as diffusion between a liquid and a gas. Diffusion, by definition, is the result of molecules moving randomly to fill available space, including spaces within another phase."
    },
    {
        question: "A gas sample is subjected to significant external pressure, resulting in a considerable reduction of its total volume. This behavior is fundamentally possible due to which structural aspect of gases at the molecular level?",
        options: [
            "The vast empty spaces between individual particles.",
            "The high kinetic energy of their molecules.",
            "The perfectly elastic nature of their collisions.",
            "The negligible effect of gravity on their movement."
        ],
        correctAnswer: 1,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. Gases are easily compressible because there are large spaces between their particles. Applying pressure reduces these spaces, thereby reducing the total volume."
    },
    {
        question: "Imagine comparing the effect of a specific temperature elevation on the volume change of two different gaseous substances, A and B, confined under identical initial conditions. Which statement accurately reflects their comparative response, assuming ideal behavior?",
        options: [
            "Gas A's volume change would be greater due to its unique molecular structure.",
            "Gas B's volume change would be smaller due to its higher molar mass.",
            "Both gases would experience a proportionally similar change in volume.",
            "The gas with weaker intermolecular forces would show a larger volume change."
        ],
        correctAnswer: 2,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document states that 'The volume of gases is affected similarly by temperature and pressure changes, irrespective of their nature.' This implies that under ideal conditions, the proportional response to temperature changes is universal for all gases."
    },
    {
        question: "According to the Kinetic Molecular Theory, if a gas exhibits perfectly elastic collisions, what is the most direct implication for the overall energy state of the system during molecular interactions?",
        options: [
            "Individual molecular velocities will always increase.",
            "The average potential energy of the system remains constant.",
            "Total momentum is perpetually conserved, but not energy.",
            "The total kinetic energy of the system remains unchanged."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. One of the postulates of the KMT is that collisions are perfectly elastic, meaning total kinetic energy remains constant during collisions."
    },
    {
        question: "Which historical figure first postulated the fundamental idea that gas behavior could be explained by the movement of microscopic particles?",
        options: [
            "James Maxwell, through his elaborate equations.",
            "Rudolf Clausius, via his kinetic equation derivation.",
            "Ludwig Boltzmann, with his statistical interpretations.",
            "Daniel Bernoulli, as part of an early conceptual framework."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The historical context of KMT states it was 'Postulated by Daniel Bernoulli'."
    },
    {
        question: "If the absolute temperature of a gas is doubled, what fundamental change is implied about the average kinetic energy of its constituent molecules?",
        options: [
            "It remains constant, as kinetic energy is intrinsic to the molecule.",
            "It also doubles, directly reflecting the temperature change.",
            "It increases by a factor of four due to the square relationship.",
            "It decreases by half due to inverse proportionality."
        ],
        correctAnswer: 1,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. A key postulate of the KMT is that 'The average kinetic energy (KE) of a molecule is directly proportional to the absolute temperature (KE ∝ T)'. Therefore, if the absolute temperature doubles, the average kinetic energy also doubles."
    },
    {
        question: "The KMT posits that the volume occupied by the molecules themselves is negligible compared to the total container volume. What macroscopic gas property is best explained by this specific postulate?",
        options: [
            "The ease with which gases can be compressed.",
            "The production of pressure on container walls.",
            "The diffusion of gases into empty space.",
            "The direct proportionality between kinetic energy and temperature."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The KMT states: 'The volume occupied by the molecules themselves is negligible compared to the total volume of the container (explains compressibility)'."
    },
    {
        question: "Considering the molecular motion types, what combination of motions would be universally observed in all molecules, regardless of their complexity, when in the gaseous state?",
        options: [
            "Only movement of the entire molecule from place to place.",
            "Spinning about the center of gravity and internal oscillations.",
            "All three types: translational, rotational, and vibrational.",
            "Rotational motion exclusively, as it is energy-efficient."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document states that 'Translational Motion: Movement of the entire molecule from place to place in all possible directions. (All molecules exhibit this)'."
    },
    {
        question: "When a gas molecule undergoes vibrational motion, which type of energy transformation is continuously occurring within the molecule?",
        options: [
            "Conversion of translational energy to rotational energy.",
            "Interchange solely between kinetic energy and heat.",
            "Continuous interchange between kinetic and potential energy.",
            "Only a continuous decrease in potential energy."
        ],
        correctAnswer: 2,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The text explicitly states that 'Vibrational motion involves continuous interchange between kinetic and potential energy'."
    },
    {
        question: "Imagine a monatomic gas, such as Helium, at a specific temperature. What is the sole type of molecular motion exhibited by its particles?",
        options: [
            "Rotational motion.",
            "Vibrational motion.",
            "A combination of rotational and vibrational motion.",
            "Translational motion."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document specifies: 'Monatomic molecules (e.g., He) exhibit only translational motion'."
    },
    {
        question: "The KMT asserts that gas pressure results from a particular molecular action. Which action is this?",
        options: [
            "The attractive forces between molecules.",
            "The internal energy of the molecules.",
            "The perfect elasticity of molecular interactions.",
            "Molecular collisions with the container walls."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. One of the postulates of the KMT is that 'Pressure is produced by molecular collisions with the container walls'."
    },
    {
        question: "If gas molecules of the same substance are at two different absolute temperatures, what can be definitively stated about their average molecular characteristics based on the KMT?",
        options: [
            "Their average kinetic energy will be identical.",
            "Their mass and size will remain identical.",
            "Their translational velocity will be the same.",
            "Their rotational and vibrational energies will be equal."
        ],
        correctAnswer: 1,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. A KMT postulate states: 'Molecules of the same gas have identical mass and size'. Temperature changes affect kinetic energy, not fundamental molecular properties like mass and size."
    },
    {
        question: "The KMT postulates that gravitational force has a negligible impact on individual gas molecules. What macroscopic consequence does this imply about gas behavior within a container?",
        options: [
            "Gases will expand indefinitely unless contained.",
            "Gases will settle to the bottom of the container.",
            "Gases will exert pressure anisotropically.",
            "Gases will uniformly distribute throughout the container volume."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. If 'the force of gravity has almost no effect on gas molecules', then there is no tendency for them to accumulate at the bottom or top of a container; they will diffuse and distribute evenly, as also implied by their random motion."
    },
    {
        question: "What is the fundamental physical definition of pressure, as applied to gases, in terms of force and area?",
        options: [
            "The total force exerted on the entire container surface.",
            "The amount of force acting perpendicular to a unit surface area.",
            "The volume occupied by gas molecules per unit force.",
            "The kinetic energy transferred per unit time."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document defines pressure (P) as 'force (F) exerted per unit area (A): P = F/A'."
    },
    {
        question: "Why does atmospheric pressure vary depending on geographical location, temperature, and current weather conditions?",
        options: [
            "The Earth's magnetic field influences atmospheric density.",
            "The total mass of the atmospheric column changes with these factors.",
            "The gravitational attraction of the moon fluctuates significantly.",
            "Solar radiation directly alters the chemical composition of air."
        ],
        correctAnswer: 2,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The text states: 'Atmospheric Pressure: The pressure exerted by the Earth's atmosphere, which is a column of air attracted by gravity. Its value depends on location, temperature, and weather'."
    },
    {
        question: "What specific apparatus is commonly employed to quantitatively determine the pressure of a contained gas sample?",
        options: [
            "A spectrometer for analyzing composition.",
            "A calorimeter for measuring heat changes.",
            "A potentiometer for electrical potential differences.",
            "A manometer for direct pressure readings."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document explicitly states: 'A manometer is an apparatus used to measure gas pressure'."
    },
    {
        question: "Considering the SI unit for pressure, how is it fundamentally defined in terms of force and distance?",
        options: [
            "One Joule per cubic meter.",
            "One Newton per meter.",
            "One kilogram-force per square centimeter.",
            "One Newton per square meter."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The SI unit for pressure is Pascal (Pa), defined as 'one Newton per square meter (1 Pa = 1 N/m² = 1 Nm⁻²)'."
    },
    {
        question: "If a pressure reading is given in 'millimeters of mercury,' which other common pressure unit represents an equivalent magnitude?",
        options: [
            "Kilopascal.",
            "Torr.",
            "Atmosphere.",
            "Dyne per square centimeter."
        ],
        correctAnswer: 1,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document lists: 'Millimeters of Mercury (mm Hg) / Torr: 1 atm = 760 mm Hg = 760 torr'."
    },
    {
        question: "Charles's Law conceptually proposes a hypothetical condition for a gas. At what specific temperature, if a gas were to obey this law perfectly, would its volume theoretically cease to exist?",
        options: [
            "0 Kelvin.",
            "273.15 degrees Celsius.",
            "The liquefaction point of the gas.",
            "Standard Temperature and Pressure."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. Charles's Law 'suggests a gas would have zero volume at -273.15°C (hypothetically). Lord Kelvin established this scale where -273.15°C is defined as 0 Kelvin (0 K)'."
    },
    {
        question: "For a fixed mass of gas maintained at a constant temperature, if its volume is halved, what immediate effect is predicted on its pressure?",
        options: [
            "It will double.",
            "It will remain constant.",
            "It will decrease by half.",
            "It will increase by a factor of four."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. Boyle's Law states that at constant temperature and fixed mass, 'the pressure is inversely proportional to its volume'. If volume is halved, pressure must double to maintain the constant product."
    },
    {
        question: "When graphing the relationship between pressure and the inverse of volume for a gas at a constant temperature, what geometrical characteristic defines the resulting plot?",
        options: [
            "A hyperbola.",
            "An exponential curve.",
            "A straight line passing through the origin.",
            "A logarithmic curve."
        ],
        correctAnswer: 2,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The graphical representation of Boyle's Law specifies that 'P vs 1/V plot is a straight line'."
    },
    {
        question: "What term specifically denotes the graphical curves representing the pressure-volume relationship of a gas held at a constant temperature?",
        options: [
            "Isobars.",
            "Adiabats.",
            "Isotherms.",
            "Isometrics."
        ],
        correctAnswer: 2,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The text states that for Boyle's Law, 'Curves at constant temperature are called Isotherms'."
    },
    {
        question: "In the context of Charles's Law, what term describes a graph depicting the volume-temperature relationship of a gas at constant pressure?",
        options: [
            "Isotherms.",
            "Isobars.",
            "Isosceles.",
            "Isometrics."
        ],
        correctAnswer: 1,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The text states that for Charles's Law, 'Lines at constant pressure are called Isobars'."
    },
    {
        question: "A key implication of Avogadro's Law is that at identical conditions of temperature and pressure, samples of different gases possessing equal volumes will share a specific common attribute. What is that attribute?",
        options: [
            "The same number of molecules.",
            "Identical molar masses.",
            "Equivalent chemical reactivity.",
            "The same density."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. Avogadro's Law states: 'At the same temperature and pressure, equal volumes of different gases contain the same number of molecules (or moles)'."
    },
    {
        question: "Real gases often deviate from Charles's Law at very low temperatures. What is the primary physical reason for this observed deviation before reaching absolute zero?",
        options: [
            "The gas molecules undergo significant decomposition.",
            "The average kinetic energy becomes negligible.",
            "Intermolecular attractive forces lead to phase transition.",
            "The gas molecules expand considerably."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document explains: 'Real gases liquefy or solidify before reaching absolute zero due to intermolecular forces'."
    },
    {
        question: "What is the essential requirement for temperature units when performing calculations using the fundamental gas laws?",
        options: [
            "Degrees Celsius only.",
            "Fahrenheit only.",
            "Any temperature scale can be used interchangeably.",
            "Absolute temperature in Kelvin."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document clearly states: 'Absolute temperature must be used in all gas law calculations involving temperature'."
    },
    {
        question: "According to the early form of Charles's Law, what is the proportional change in volume for a given mass of gas at 0°C for every one degree Celsius change in temperature?",
        options: [
            "An increase or decrease by 1/273 of its original volume.",
            "A doubling of volume for every 10-degree change.",
            "A constant volume regardless of temperature fluctuations.",
            "A change directly proportional to its molecular mass."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The 'Early Form' of Charles's Law is given as: 'The volume of a given mass of gas increases or decreases by 1/273 times its original volume at 0°C for every 1°C rise or fall in temperature'."
    },
    {
        question: "At Standard Temperature and Pressure (STP), what specific volume does one mole of any ideal gas occupy?",
        options: [
            "22.414 cubic decimeters.",
            "1.0 cubic meter.",
            "101.325 kilopascals.",
            "0 degrees Celsius."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. Avogadro's Law states as a 'Key Fact': 'One mole of any ideal gas occupies 22.414 dm³ at Standard Temperature and Pressure (STP)'."
    },
    {
        question: "The Ideal Gas Equation synthesizes the relationships established by several fundamental gas laws. Which specific combination of laws underpins its derivation?",
        options: [
            "Dalton's Law of Partial Pressures and Graham's Law of Effusion.",
            "Amontons's Law and Henry's Law.",
            "Boyle's Law, Charles's Law, and Avogadro's Law.",
            "Gay-Lussac's Law and Raoult's Law."
        ],
        correctAnswer: 2,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The derivation of the Ideal Gas Equation combines the proportionalities from 'Boyle's Law, Charles's Law, and Avogadro's Law'."
    },
    {
        question: "What is the SI unit equivalent of the universal gas constant (R) when pressure is expressed in Newtons per square meter and volume in cubic meters?",
        options: [
            "Atmosphere-liter per mole-Kelvin.",
            "Calories per mole-Kelvin.",
            "Pascal-cubic decimeter per mole-Kelvin.",
            "Joules per mole-Kelvin."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document states that 'In SI units (P in N/m², V in m³): R ≈ 8.314 J·mol⁻¹·K⁻¹ (since N·m = Joule)'."
    },
    {
        question: "When applying the Ideal Gas Equation to compare a gas under two different sets of conditions, what is the generalized mathematical relationship that combines pressure, volume, and temperature?",
        options: [
            "The product of pressure and volume equals a constant.",
            "The ratio of volume to temperature remains constant.",
            "The inverse of pressure is proportional to volume.",
            "The ratio of the product of pressure and volume to temperature is constant."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The 'Generalized Form for Changing Conditions' of the Ideal Gas Equation is given as P₁V₁/T₁ = P₂V₂/T₂. This implies that the ratio of the product of pressure and volume to temperature is constant."
    },
    {
        question: "What specific environmental conditions define Standard Temperature and Pressure (STP) for gas comparisons?",
        options: [
            "100 degrees Celsius and 1 Pascal.",
            "0 degrees Celsius and 1 atmosphere.",
            "25 degrees Celsius and 1 kilopascal.",
            "273.15 Kelvin and 760 Torr."
        ],
        correctAnswer: 1,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document defines 'Standard Temperature and Pressure (STP)' as '0°C (273.15 K) and 1 atmosphere'."
    },
    {
        question: "Beyond simply determining pressure, volume, or temperature, the Ideal Gas Equation can be rearranged to find other intensive properties of a gas. Which property directly relates to the mass per unit volume of the gas?",
        options: [
            "Density.",
            "Molecular mass.",
            "Concentration.",
            "Specific heat capacity."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. Under 'Applications of Ideal Gas Equation', it mentions: 'Density (d): By substituting d = m/V, we get d = PM/RT'. Density is mass per unit volume."
    },
    {
        question: "In the context of Ideal Gas Equation applications, if one aims to determine the concentration of a gas, which ratio derived from the equation is most directly relevant?",
        options: [
            "The ratio of pressure to molar mass.",
            "The product of pressure and volume.",
            "The ratio of moles to volume.",
            "The product of temperature and the gas constant."
        ],
        correctAnswer: 2,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The 'Applications of Ideal Gas Equation' section states: 'Concentration (c): By substituting c = n/V, we get c = P/RT'. Concentration is defined as moles per unit volume (n/V)."
    },
    {
        question: "What fundamental characteristic distinguishes an 'ideal gas' from any 'real gas'?",
        options: [
            "Ideal gases exhibit strong intermolecular forces, unlike real gases.",
            "Real gases always have a lower average kinetic energy than ideal gases.",
            "Ideal gases perfectly adhere to gas laws under all conditions.",
            "Real gases possess negligible molecular volume, whereas ideal gases do not."
        ],
        correctAnswer: 2,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document defines an 'Ideal Gas' as 'a hypothetical gas that perfectly obeys the Ideal Gas Equation (PV=nRT) and all gas laws under all conditions. No real gas is truly ideal'."
    },
    {
        question: "Under what specific combination of external conditions do real gases typically exhibit the most significant deviations from ideal behavior?",
        options: [
            "High temperatures and low pressures.",
            "Moderate temperatures and pressures.",
            "Low temperatures and low pressures.",
            "Low temperatures and high pressures."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document states that real gases 'deviate from ideal behavior, especially at low temperatures and high pressures'."
    },
    {
        question: "One primary reason for the deviation of real gases from ideal behavior, as attributed by Van der Waals, concerns the inherent physical space occupied by the gas molecules themselves. Under what specific condition does this molecular volume become a significant factor?",
        options: [
            "At very low pressures, where molecules are far apart.",
            "At very high temperatures, enhancing molecular vibration.",
            "At moderate temperatures, promoting molecular rotation.",
            "At high pressures, as molecules are forced into closer proximity."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. One cause for deviation is 'Negligible Volume of Gas Molecules'. The text elaborates: 'At high pressures, molecules are forced closer, and their actual volume becomes a significant fraction of the container's total volume'."
    },
    {
        question: "How does the significance of intermolecular attractive forces, another key cause of deviation, manifest in gas behavior at low temperatures?",
        options: [
            "They become more prominent due to reduced kinetic energy.",
            "They diminish as molecules move faster, overcoming attraction.",
            "They are entirely negligible, enhancing ideal behavior.",
            "They cause molecules to expand, increasing gas volume."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document explains: 'At low temperatures (lower kinetic energy) and high pressures (molecules closer), attractive (Van der Waals) forces become significant'."
    },
    {
        question: "For a real gas, a compressibility factor value less than one (Z < 1) implies which dominant intermolecular interaction and its effect on gas volume compared to ideal predictions?",
        options: [
            "Repulsive forces, leading to a larger volume than ideal.",
            "No dominant forces, indicating ideal behavior.",
            "Attractive forces, causing a smaller volume than ideal.",
            "Increased molecular kinetic energy, resulting in greater volume."
        ],
        correctAnswer: 2,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. For the Compressibility Factor (Z), it states: 'Z < 1: Occurs at moderate to high pressures, indicating attractive forces dominate, and the gas volume is less than ideal'."
    },
    {
        question: "At extremely high pressures, the compressibility factor (Z) for a real gas typically rises above one (Z > 1). What primary interaction or factor accounts for this increase in volume relative to an ideal gas?",
        options: [
            "Dominant attractive forces pulling molecules closer.",
            "The increased kinetic energy of individual molecules.",
            "The negligible volume of the gas molecules.",
            "Significant molecular volume and repulsive forces between molecules."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. For the Compressibility Factor (Z), it states: 'Z > 1: Occurs at very high pressures, indicating repulsive forces and the molecular volume become significant, making the gas volume greater than ideal'."
    },
    {
        question: "Under which specific conditions do real gases most closely approximate the behavior of an ideal gas?",
        options: [
            "High pressures and low temperatures.",
            "Moderate pressures and temperatures.",
            "Low temperatures and high pressures.",
            "Low pressures and high temperatures."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document clearly states: 'Real gases behave most like ideal gases at low pressures and high temperatures'."
    },
    {
        question: "The compressibility factor (Z) serves as a quantitative measure of a gas's deviation from ideality. What specific value of Z characterizes a perfectly ideal gas under all conditions?",
        options: [
            "A value that varies with temperature.",
            "Exactly 1.",
            "A value less than 1.",
            "A value greater than 1."
        ],
        correctAnswer: 1,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document states: 'For an ideal gas, Z = 1 under all conditions'."
    },
    {
        question: "Why do attractive forces between gas molecules become more significant at high pressures, contributing to non-ideal behavior?",
        options: [
            "Molecules are forced into closer proximity, enhancing interaction.",
            "Higher pressure increases the kinetic energy of molecules.",
            "Molecular volume becomes negligible at high pressures.",
            "Collisions become perfectly elastic at elevated pressures."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document links high pressure to attractive forces becoming significant: 'At ... high pressures (molecules closer), attractive (Van der Waals) forces become significant'. Closer proximity directly enhances the effect of these forces."
    },
    {
        question: "How does the Kinetic Molecular Theory's assumption about the volume of gas molecules lead to deviations from ideal behavior at high pressures?",
        options: [
            "The actual volume of molecules becomes a noticeable fraction of the container's volume, making the gas less compressible.",
            "Molecules expand considerably under high pressure, leading to greater overall volume than predicted.",
            "The assumption about molecular volume promotes perfectly elastic collisions, increasing ideality.",
            "It causes intermolecular forces to diminish, reducing deviations at high pressure."
        ],
        correctAnswer: 0,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document explains a cause for deviation: 'Negligible Volume of Gas Molecules: At high pressures, molecules are forced closer, and their actual volume becomes a significant fraction of the container's total volume, making the gas less compressible than ideal'."
    },
    {
        question: "What is the primary reason why real gases at low temperatures exhibit a smaller volume than predicted by the ideal gas equation?",
        options: [
            "Their molecular volume increases significantly at low temperatures.",
            "Their kinetic energy becomes too high, causing repulsion.",
            "Attractive intermolecular forces draw molecules closer together.",
            "The gas begins to solidify, thus reducing its overall mass."
        ],
        correctAnswer: 2,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document states: 'At low temperatures (lower kinetic energy) and high pressures (molecules closer), attractive (Van der Waals) forces become significant. These forces reduce the volume more than predicted by gas laws'."
    },
    {
        question: "The Kinetic Molecular Theory assumes no attractive or repulsive forces exist between gas molecules. Which specific conditions exacerbate the invalidity of this assumption for real gases?",
        options: [
            "High temperatures and low pressures, ensuring rapid motion.",
            "Moderate temperatures and pressures, balancing interactions.",
            "Very low molecular masses, reducing gravitational effects.",
            "High pressures and low temperatures, increasing molecular proximity and reducing energy."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document explicitly states that intermolecular forces become significant 'At low temperatures (lower kinetic energy) and high pressures (molecules closer)', which are the conditions where the KMT assumption of no forces fails most dramatically."
    },
    {
        question: "Considering the historical development of KMT, which scientist derived the fundamental kinetic equation that relates macroscopic pressure to microscopic molecular properties?",
        options: [
            "Daniel Bernoulli.",
            "James Maxwell.",
            "Ludwig Boltzmann.",
            "Rudolf Clausius."
        ],
        correctAnswer: 3,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. Under 'Historical Context' for KMT, it states: 'Clausius (1857) derived the kinetic equation'."
    },
    {
        question: "The Kelvin temperature scale defines 0 K as the point where a hypothetical ideal gas would possess zero volume. What specific Celsius temperature corresponds to this absolute zero?",
        options: [
            "0 degrees Celsius.",
            "-273.15 degrees Celsius.",
            "100 degrees Celsius.",
            "-100 degrees Celsius."
        ],
        correctAnswer: 1,
        reasoning: "it's mention in Textbook theroy as then reasoning for correct Options. The document states: 'Lord Kelvin established this scale where -273.15°C is defined as 0 Kelvin (0 K)'."
    }
];

// Constants
const QUIZ_ACCESS_CODE = "PreMium-A-12345";
const DEV_ACCESS_CODE = "Dev-PDA-001";
const ACADEMY_NAME = "WHITE COAT WORRIORS ";
const QUIZ_SUBJECT = "Biology ";
const WEBSITE_LINK = "https://premiumdoctoracademy.com";
const WHATSAPP_CONTACT = "03287743851";
const WHATSAPP_COMMUNITY = "https://whatsapp.com/channel/0029VaFCIU6EquiOlXWcNR1X";
const TIME_PER_MCQ = 60;
const MARK_PER_MCQ = 1;
const NEGATIVE_MARKING = 0;

// Global state variables
let currentQuizId = 'WCW-CHE-005';
let quizData = quizData_WCW_CHE_005;
let currentQuestion = 0;
let userAnswers = Array(quizData.length).fill(null);
let timeLeft;
let questionTimeLeft;
let totalTimeInterval;
let questionTimeInterval;
let studentData = {};
let studentAccessCode = "";

// DOM elements
const questionNavEl = document.getElementById('question-nav');
const questionTextEl = document.getElementById('question-text');
const optionsContainerEl = document.getElementById('options-container');
const reasoningEl = document.getElementById('reasoning');
const reasoningTextEl = document.getElementById('reasoning-text');
const quizTitleEl = document.getElementById('quiz-title');
const quizSubjectEl = document.getElementById('quiz-subject');
const perMcqTimeEl = document.getElementById('per-mcq-time');
const totalTimerEl = document.getElementById('timer');
const questionTimerEl = document.getElementById('question-timer');
const quizProgressEl = document.getElementById('quiz-progress');
const studentInfoTable = document.getElementById('student-info-table');
const quizResultsTable = document.getElementById('quiz-results-table');
const allMcqsList = document.getElementById('all-mcqs-list');
const devPasswordInput = document.getElementById('developerPassword');
const devErrorBox = document.getElementById('dev-error-box');
const quizAccessCodeInput = document.getElementById('quizAccessCode');
const quizAccessErrorBox = document.getElementById('quiz-error-box');
const toggleDevPasswordIcon = document.getElementById('toggleDeveloperPassword');
const toggleQuizCodeIcon = document.getElementById('toggleQuizAccessCode');
const websiteLinkEl = document.getElementById('website-link');
const whatsappContactLinkEl = document.getElementById('whatsapp-contact-link');
const whatsappCommunityLinkEl = document.getElementById('whatsapp-community-link');
const reasoningBtn = document.getElementById('reasoning-btn');
const quizNotificationEl = document.getElementById('quiz-notification');
const notificationTitleEl = document.getElementById('notification-title');
const notificationMessageEl = document.getElementById('notification-message');
const notificationYesBtn = document.getElementById('notification-yes');
const notificationNoBtn = document.getElementById('notification-no');
const correctCountEl = document.getElementById('correct-count');
const incorrectCountEl = document.getElementById('incorrect-count');
const unansweredCountEl = document.getElementById('unanswered-count');
const performanceFillEl = document.getElementById('performance-fill');


/**
 * @description Sends data to the Google Apps Script endpoint.
 * @param {object} data - The payload containing type ('registration' or 'quiz_result') and data.
 */
function sendDataToSheet(data) {
    if (!SHEET_SCRIPT_URL || SHEET_SCRIPT_URL.includes('YOUR_DEPLOYED_WEB_APP_URL')) {
        console.error('SHEET_SCRIPT_URL is not configured. Data not sent to Google Sheet.');
        return Promise.resolve({ success: false, message: 'Script URL not configured.' });
    }

    return fetch(SHEET_SCRIPT_URL, {
        method: 'POST',
        // 'no-cors' is necessary for Apps Script to accept cross-origin POST requests from a web page
        mode: 'no-cors',
        cache: 'no-cache',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        // Cannot read response body with 'no-cors', assume request was sent successfully
        return { success: true, message: 'Request sent to Google Script.' };
    })
    .catch(error => {
        console.error('Sheet Data Send Error:', error);
        return { success: false, message: 'Failed to send request to Google Script.' };
    });
}


// Initialization
document.addEventListener('DOMContentLoaded', () => {
    const storedStudentData = localStorage.getItem('studentData');
    if (storedStudentData) {
        studentData = JSON.parse(storedStudentData);
        document.getElementById('studentName').value = studentData['Student Name'] || '';
        document.getElementById('fatherName').value = studentData['Father Name'] || '';
        document.getElementById('email').value = studentData['Email'] || '';
        document.getElementById('mobile').value = studentData['Mobile'] || '';
        document.getElementById('city').value = studentData['City'] || '';
    }
    const storedCode = localStorage.getItem('studentAccessCode');
    if (storedCode) {
        studentAccessCode = storedCode;
    }
    
    showPage('signin-page');
    
    if (toggleDevPasswordIcon) toggleDevPasswordIcon.addEventListener('click', () => togglePasswordVisibility('developerPassword', 'toggleDeveloperPassword'));
    if (toggleQuizCodeIcon) toggleQuizCodeIcon.addEventListener('click', () => togglePasswordVisibility('quizAccessCode', 'toggleQuizAccessCode'));
});

function showQuizNotification(title, message, type = 'info') {
    const allowedNotifications = ['Registration Successful', 'Access Granted', 
                                 'Quiz Completed!', 'Quiz Reset', 'Registration Error', 'Submission Error', 'Registration Warning'];
    
    if (!allowedNotifications.includes(title)) {
        return;
    }
    
    notificationTitleEl.textContent = title;
    notificationMessageEl.textContent = message;
    
    quizNotificationEl.classList.remove('warning', 'error');
    
    if (type === 'warning') {
        quizNotificationEl.classList.add('warning');
    } else if (type === 'error') {
        quizNotificationEl.classList.add('error');
    }
    
    quizNotificationEl.classList.add('show');
    
    setTimeout(() => {
        if (quizNotificationEl.classList.contains('show')) {
            hideQuizNotification();
        }
    }, 5000);
}

function hideQuizNotification() {
    quizNotificationEl.classList.remove('show');
}

function showPage(pageId) {
    const pages = document.querySelectorAll('.page');
    pages.forEach(page => page.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    document.querySelectorAll('.error-box, .success-box').forEach(el => el.style.display = 'none');
}

function togglePasswordVisibility(inputID, iconID) {
    const passwordInput = document.getElementById(inputID);
    const toggleIcon = document.getElementById(iconID);
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye');
    } else {
        passwordInput.type = 'password';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash');
    }
}

function showQuizAccessForm() {
    document.getElementById('quiz-access-form').style.display = 'flex';
    document.getElementById('developer-access-form').style.display = 'none';
}

function showDeveloperAccessForm() {
    document.getElementById('developer-access-form').style.display = 'flex';
    document.getElementById('quiz-access-form').style.display = 'none';
}

function showRegistrationPage() {
    showPage('registration-page');
}

// Registration Handler
function generateAccessCode(studentName, fatherName) {
    const studentInitials = studentName.split(' ').map(n => n[0]).join('').toUpperCase();
    const fatherInitials = fatherName.split(' ').map(n => n[0]).join('').toUpperCase();
    const uniqueId = Math.random().toString(36).substring(2, 7).toUpperCase();

    return `${ACADEMY_NAME.replace(/\s+/g, '-')}-${studentInitials}${fatherInitials}-${uniqueId}`;
}

function handleRegistration() {
    const sName = document.getElementById('studentName').value.trim();
    const fName = document.getElementById('fatherName').value.trim();
    const email = document.getElementById('email').value.trim();
    const mobile = document.getElementById('mobile').value.trim();
    const city = document.getElementById('city').value.trim();
    
    if (!sName || !fName || !email || !mobile || !city) {
        showQuizNotification('Registration Error', 'Please fill in all the registration details.', 'error');
        return;
    }
    
    // Generate access code
    const generatedCode = generateAccessCode(sName, fName);
    studentAccessCode = generatedCode;

    studentData = {
        'Student Name': sName,
        'Father Name': fName,
        'Email': email,
        'Mobile': mobile,
        'City': city
    };

    // --- NEW: SEND REGISTRATION DATA TO GOOGLE SHEET ---
    const registrationDataToSend = {
        type: 'registration',
        accessCode: generatedCode,
        studentName: sName,
        fatherName: fName,
        email: email,
        mobile: mobile,
        city: city
    };
    
    sendDataToSheet(registrationDataToSend)
        .then(response => {
            console.log('Sheet Registration Response:', response);
            showQuizNotification('Registration Successful', `Your code: ${generatedCode}. Data submitted to sheet.`, 'info');
        })
        .catch(error => {
            console.error('Sheet Registration Error:', error);
            showQuizNotification('Registration Warning', `Registration saved locally, but sheet submission failed.`, 'warning');
        });
    // ----------------------------------------------------
    
    // Store data locally
    localStorage.setItem('studentAccessCode', generatedCode);
    localStorage.setItem('studentData', JSON.stringify(studentData));
    
    const registrations = JSON.parse(localStorage.getItem('wcwRegistrations') || '[]');
    registrations.push({
        ...studentData,
        accessCode: generatedCode,
        timestamp: new Date().toISOString()
    });
    localStorage.setItem('wcwRegistrations', JSON.stringify(registrations));
    
    
    // Start the quiz after registration
    startQuiz('WCW-CHE-005', 'Student', generatedCode);
}

// Quiz Access Handler
function checkDeveloperPassword() {
    devErrorBox.style.display = 'none';
    if (devPasswordInput.value === DEV_ACCESS_CODE) {
        showQuizNotification('Access Granted', 'Welcome! You have successfully logged in as a developer.', 'info');
        startQuiz('WCW-CHE-005', 'Developer', DEV_ACCESS_CODE);
    } else {
        devErrorBox.style.display = 'block';
    }
}

function accessQuiz(inputCode) {
    const errorBox = document.getElementById('quiz-error-box');
    errorBox.style.display = 'none';
    
    const storedStudentCode = localStorage.getItem('studentAccessCode');
    
    if (inputCode === QUIZ_ACCESS_CODE || inputCode === DEV_ACCESS_CODE || inputCode === storedStudentCode) {
        showQuizNotification('Access Granted', 'Welcome! You can now start the quiz.', 'info');
        startQuiz('WCW-CHE-005', 'Student', inputCode);
    } else {
        errorBox.style.display = 'block';
    }
}

function startQuiz(quizId, userType, code) {
    currentQuizId = quizId;
    quizData = quizData_WCW_CHE_005;
    
    // Always start fresh - no progress restoration
    currentQuestion = 0;
    userAnswers = Array(quizData.length).fill(null);
    
    timeLeft = quizData.length * TIME_PER_MCQ;
    questionTimeLeft = TIME_PER_MCQ;
    
    localStorage.setItem('lastAccessCode', code);

    showPage('quiz-page');
    initQuiz();
}

// Quiz Logic
function initQuiz() {
    quizSubjectEl.textContent = QUIZ_SUBJECT;
    perMcqTimeEl.textContent = Math.floor(TIME_PER_MCQ / 60);
    
    websiteLinkEl.href = WEBSITE_LINK;
    whatsappContactLinkEl.href = 'https://wa.me/' + WHATSAPP_CONTACT;
    whatsappCommunityLinkEl.href = WHATSAPP_COMMUNITY;
    
    quizTitleEl.textContent = `Test - ID: ${currentQuizId}`;
    renderQuestionNav();
    renderQuestion();

    if (totalTimeInterval) clearInterval(totalTimeInterval);
    if (questionTimeInterval) clearInterval(questionTimeInterval);
    
    totalTimeInterval = setInterval(updateTotalTimer, 1000);
    questionTimeInterval = setInterval(updateQuestionTimer, 1000);
}

function updateTotalTimer() {
    if (timeLeft > 0) {
        timeLeft--;
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        totalTimerEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    } else {
        clearInterval(totalTimeInterval);
        submitTest(true);
    }
}

function updateQuestionTimer() {
    if (questionTimeLeft > 0) {
        questionTimeLeft--;
        questionTimerEl.textContent = `${questionTimeLeft}`;
    } else {
        questionTimeLeft = TIME_PER_MCQ;
        navigateQuestion('next');
    }
}

function renderQuestionNav() {
    questionNavEl.innerHTML = '';
    quizData.forEach((_, index) => {
        const navItem = document.createElement('div');
        navItem.classList.add('question-nav-item');
        navItem.textContent = index + 1;
        navItem.onclick = () => navigateQuestion(index);
        
        if (index === currentQuestion) {
            navItem.classList.add('current');
        } else if (userAnswers[index] !== null) {
            navItem.classList.add('solved');
        } else if (userAnswers.slice(0, index).some(ans => ans !== null) || index < currentQuestion) {
             navItem.classList.add('visited');
        }
        
        questionNavEl.appendChild(navItem);
    });
    updateProgressBar();
}

function updateProgressBar() {
    const solvedCount = userAnswers.filter(answer => answer !== null).length;
    const progress = (solvedCount / quizData.length) * 100;
    quizProgressEl.style.width = `${progress}%`;
}

function renderQuestion() {
    reasoningEl.style.display = 'none';
    reasoningBtn.classList.add('disabled');
    const question = quizData[currentQuestion];
    questionTextEl.textContent = `${currentQuestion + 1}. ${question.question}`;
    
    optionsContainerEl.innerHTML = '';
    question.options.forEach((option, index) => {
        const optionEl = document.createElement('div');
        optionEl.classList.add('option');
        optionEl.textContent = option;
        
        const isAnswered = userAnswers[currentQuestion] !== null;

        if (!isAnswered) {
            optionEl.onclick = () => selectOption(index);
        } else {
            if (index === question.correctAnswer) {
                optionEl.classList.add('correct');
            } else if (index === userAnswers[currentQuestion]) {
                optionEl.classList.add('incorrect');
            }
        }
        
        if (userAnswers[currentQuestion] === index) {
            optionEl.classList.add('selected');
        }

        optionsContainerEl.appendChild(optionEl);
    });
    
    questionTimeLeft = TIME_PER_MCQ;
    questionTimerEl.textContent = `${questionTimeLeft}`;
    renderQuestionNav();
    
    if (userAnswers[currentQuestion] !== null) {
        reasoningBtn.classList.remove('disabled');
    }
}

function selectOption(optionIndex) {
    const question = quizData[currentQuestion];
    userAnswers[currentQuestion] = optionIndex;
    
    reasoningBtn.classList.remove('disabled');
    
    const options = optionsContainerEl.querySelectorAll('.option');
    options.forEach((option, index) => {
        option.onclick = null;
        option.classList.remove('selected', 'correct', 'incorrect');
        
        if (index === question.correctAnswer) {
            option.classList.add('correct');
        } else if (index === optionIndex) {
            option.classList.add('incorrect');
        }
        
        if (index === optionIndex) {
             option.classList.add('selected');
        }
    });

    renderQuestionNav();
    
    setTimeout(() => {
        navigateQuestion('next');
    }, 800);
}

function navigateQuestion(direction) {
    const totalQuestions = quizData.length;
    let nextIndex;

    if (typeof direction === 'number') {
        nextIndex = direction;
    } else if (direction === 'next') {
        nextIndex = (currentQuestion + 1) % totalQuestions;
    } else if (direction === 'prev') {
        nextIndex = (currentQuestion - 1 + totalQuestions) % totalQuestions;
    } else {
        return;
    }

    if (nextIndex === currentQuestion) return;
    
    currentQuestion = nextIndex;
    renderQuestion();
}

function toggleReasoning() {
    if (reasoningBtn.classList.contains('disabled')) return;
    
    const question = quizData[currentQuestion];
    if (reasoningEl.style.display === 'block') {
        reasoningEl.style.display = 'none';
    } else {
        reasoningTextEl.textContent = question.reasoning;
        reasoningEl.style.display = 'block';
    }
}

function submitTest(isTimeout = false) {
    if (!isTimeout && !confirm('Are you sure you want to submit the quiz?')) {
        return;
    }
    
    clearInterval(totalTimeInterval);
    clearInterval(questionTimeInterval);

    let correct = 0;
    let incorrect = 0;
    let unanswered = 0;

    quizData.forEach((question, index) => {
        if (userAnswers[index] === null) {
            unanswered++;
        } else if (userAnswers[index] === question.correctAnswer) {
            correct++;
        } else {
            incorrect++;
        }
    });

    const totalQuestions = quizData.length;
    const totalScore = (correct * MARK_PER_MCQ) - (incorrect * NEGATIVE_MARKING);
    const totalMarks = totalQuestions * MARK_PER_MCQ;

    correctCountEl.textContent = correct;
    incorrectCountEl.textContent = incorrect;
    unansweredCountEl.textContent = unanswered;
    
    const performancePercentage = (correct / totalQuestions) * 100;
    performanceFillEl.style.width = `${performancePercentage}%`;

    const savedStudentData = JSON.parse(localStorage.getItem('studentData') || '{}');
    const lastAccessCode = localStorage.getItem('lastAccessCode') || 'N/A';
    
    let studentInfoHtml = '';
    for (const [key, value] of Object.entries(savedStudentData)) {
        studentInfoHtml += `<tr><td>${key}</td><td>${value}</td></tr>`;
    }
    studentInfoHtml += `<tr><td>Access Code Used</td><td>${lastAccessCode}</td></tr>`;
    studentInfoTable.innerHTML = studentInfoHtml;

    quizResultsTable.innerHTML = `
        <tr><td>Quiz ID</td><td>${currentQuizId}</td></tr>
        <tr><td>Total Questions</td><td>${totalQuestions}</td></tr>
        <tr><td>Correct Answers</td><td>${correct}</td></tr>
        <tr><td>Incorrect Answers</td><td>${incorrect}</td></tr>
        <tr><td>Unanswered</td><td>${unanswered}</td></tr>
        <tr><td>Your Score</td><td>${totalScore} / ${totalMarks}</td></tr>
    `;

    // --- NEW: SEND QUIZ RESULTS TO GOOGLE SHEET ---
    if (lastAccessCode && lastAccessCode !== 'N/A') {
        const resultsDataToSend = {
            type: 'quiz_result',
            accessCode: lastAccessCode,
            quizId: currentQuizId,
            totalQuestions: totalQuestions,
            correct: correct,
            incorrect: incorrect,
            unanswered: unanswered,
            totalScore: totalScore,
            totalMarks: totalMarks,
            studentName: savedStudentData['Student Name'] || 'Unknown' 
        };

        sendDataToSheet(resultsDataToSend)
            .then(response => {
                console.log('Sheet Results Update Response:', response);
            })
            .catch(error => {
                console.error('Sheet Results Update Error:', error);
                showQuizNotification('Submission Error', 'Failed to send results to the server sheet.', 'error');
            });
    }
    // ----------------------------------------------------


    const results = JSON.parse(localStorage.getItem('wcwQuizResults') || '[]');
    results.push({
        studentName: savedStudentData['Student Name'] || 'Unknown',
        accessCode: lastAccessCode,
        quizId: currentQuizId,
        totalQuestions: totalQuestions,
        correct: correct,
        incorrect: incorrect,
        unanswered: unanswered,
        totalScore: totalScore,
        totalMarks: totalMarks,
        timestamp: new Date().toISOString()
    });
    localStorage.setItem('wcwQuizResults', JSON.stringify(results));
    
    showQuizNotification('Quiz Completed!', `Your score: ${totalScore}/${totalMarks}. Check the results page for details.`, 'info');
    
    showPage('results-page');
}

function restartTest() {
    if (confirm('Are you sure you want to retake the full test? Your current progress will be lost.')) {
        quizData = quizData_WCW_CHE_005;
        currentQuestion = 0;
        userAnswers = Array(quizData.length).fill(null);
        timeLeft = quizData.length * TIME_PER_MCQ;
        
        showPage('quiz-page');
        initQuiz();
    }
}

function retakeIncorrect() {
    const incorrectIndices = quizData.map((question, index) => {
        const isIncorrect = userAnswers[index] !== null && 
                            userAnswers[index] !== question.correctAnswer;
        return isIncorrect ? index : -1;
    }).filter(index => index !== -1);
    
    if (incorrectIndices.length === 0) {
        showQuizNotification('No Incorrect Questions', 'You have no incorrect questions to retake!', 'info');
        return;
    }
    
    quizData = incorrectIndices.map(index => quizData_WCW_CHE_005[index]);
    currentQuestion = 0;
    userAnswers = Array(quizData.length).fill(null);
    timeLeft = quizData.length * TIME_PER_MCQ;
    
    showPage('quiz-page');
    initQuiz();
}

function viewAllMcqs() {
    allMcqsList.innerHTML = '';
    quizData_WCW_CHE_005.forEach((question, index) => {
        const mcqItem = document.createElement('div');
        mcqItem.classList.add('all-mcq-item');
        mcqItem.innerHTML = `
            <div class="question-text">${index + 1}. ${question.question}</div>
            <div class="all-mcq-options">
                ${question.options.map((option, optIndex) => `
                    <div class="all-mcq-option ${optIndex === question.correctAnswer ? 'correct' : ''}">
                        ${option}
                    </div>
                `).join('')}
            </div>
            <div class="all-mcq-reasoning">
                <strong>Reasoning:</strong> ${question.reasoning}
            </div>
        `;
        allMcqsList.appendChild(mcqItem);
    });
    showPage('all-mcqs-page');
}</script>